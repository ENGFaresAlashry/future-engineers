<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Spring–Mass System</title>

<style>
body {
  background: radial-gradient(circle at top,#111,#000);
  color: white;
  font-family: Arial;
  text-align: center;
}
canvas {
  background:#050505;
  margin:20px auto;
  display:block;
  border-radius:12px;
  box-shadow:0 0 25px #00e5ff33;
}
button {
  padding:12px 28px;
  margin:10px;
  border:none;
  border-radius:25px;
  background:#00e5ff;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<h1 style="color:#00e5ff">Spring–Mass Oscillation</h1>

<button onclick="start()">Start</button>
<button onclick="stop()">Stop</button>

<canvas id="sim" width="900" height="300"></canvas>
<canvas id="posC" width="900" height="220"></canvas>
<canvas id="velC" width="900" height="220"></canvas>
<canvas id="engC" width="900" height="220"></canvas>

<script>
// ================= PHYSICS =================
const m = 0.06;
const k = 8;
const L0 = 0.20;
const g = 9.8;
const dt = 0.02;

// equilibrium length
const x_eq = L0 + (m * g) / k;

// state variables (ABOUT equilibrium)
let x = x_eq + 0.02;
let v = 0;

// ================= DATA =================
let X=[], V=[], E=[];
let run=false, timer;

// ================= CONTEXTS =================
const sim = document.getElementById("sim").getContext("2d");
const p = document.getElementById("posC").getContext("2d");
const vc = document.getElementById("velC").getContext("2d");
const ec = document.getElementById("engC").getContext("2d");

// ================= SIM DRAW =================
function drawSim(){
  sim.clearRect(0,0,900,300);

  const center = 150;
  const scale = 300;

  // Ceiling
  sim.fillStyle="white";
  sim.fillRect(430,20,40,10);

  // Helical spring
  sim.strokeStyle="yellow";
  sim.lineWidth=2;
  sim.beginPath();

  const coils = 14;
  const amp = 10;
  const topY = 30;
  const bottomY = center + (x - x_eq)*scale;
  const length = bottomY - topY;

  for(let i=0;i<=100;i++){
    const t = i/100;
    const y = topY + t*length;
    const angle = coils * 2 * Math.PI * t;
    const xOffset = amp * Math.sin(angle);
    sim.lineTo(450 + xOffset, y);
  }
  sim.stroke();

  // Mass
  sim.fillStyle="red";
  sim.beginPath();
  sim.arc(450, bottomY + 18, 18, 0, Math.PI*2);
  sim.fill();
}

// ================= GRAPH =================
function drawGraph(ctx,title,ylabel,data,color,center=true){
  ctx.clearRect(0,0,900,220);

  const L=80, T=40, H=130, W=780;
  const mid=T+H/2;

  ctx.strokeStyle="#555";
  ctx.beginPath();
  ctx.moveTo(L,T);
  ctx.lineTo(L,T+H);
  ctx.lineTo(L+W,T+H);
  ctx.stroke();

  ctx.fillStyle="#00e5ff";
  ctx.font="16px Arial";
  ctx.fillText(title,L+10,25);

  ctx.fillStyle="#aaa";
  ctx.font="13px Arial";
  ctx.fillText(ylabel,10,70);
  ctx.fillText("Time (s)",830,205);

  let max=Math.max(...data.map(d=>Math.abs(d))) || 1;
  let scale=(H/2)/max*0.85;

  ctx.strokeStyle=color;
  ctx.lineWidth=2;
  ctx.beginPath();
  data.forEach((d,i)=>{
    let xg=L+i*3;
    let yg=center ? mid-d*scale : T+H-d*scale;
    if(i===0) ctx.moveTo(xg,yg);
    else ctx.lineTo(xg,yg);
  });
  ctx.stroke();
}

// ================= UPDATE =================
function step(){
  const F = -k * (x - x_eq);
  const a = F / m;

  x += v * dt + 0.5 * a * dt * dt;
  v += a * dt;

  X.push(x - x_eq);
  V.push(v);
  E.push(0.5*m*v*v + 0.5*k*(x - x_eq)**2);

  if(X.length>250){X.shift();V.shift();E.shift();}

  drawSim();
  drawGraph(p,"Position vs Time","Displacement (m)",X,"#00e5ff");
  drawGraph(vc,"Velocity vs Time","Velocity (m/s)",V,"#ff3333");
  drawGraph(ec,"Total Energy vs Time","Energy (J)",E,"#00ff88",false);
}

// ================= CONTROL =================
function start(){
  if(!run){ run=true; timer=setInterval(step,20); }
}
function stop(){
  run=false; clearInterval(timer);
}

drawSim();
</script>

</body>
</html>
